var gulp=require("gulp"),babel=require("gulp-babel"),jshint=require("gulp-jshint"),nodemon=require("gulp-nodemon"),uglify=require("gulp-uglify"),util=require("gulp-util"),mocha=require("gulp-mocha"),todo=require("gulp-todo"),webpack=require("webpack-stream"),fs=require("fs"),rev=require("gulp-rev"),replace=require("gulp-rev-replace"),clean=require("gulp-rev-dist-clean"),rimraf=require("rimraf");gulp.task("build",["build-client","build-server"]),gulp.task("clear-bin",function(){rimraf.sync("bin",{},function(){console.log("Old bin folder cleared.")})}),gulp.task("build-server",["clear-bin"],function(){return gulp.src(["src/server/**/*.*","src/server/**/*.js"]).pipe(babel()).pipe(gulp.dest("bin/server/"))}),gulp.task("build-client",["move-client","compile-client","rev-rename","rev-replace","rev-clean"]),gulp.task("move-client",["clear-bin"],function(){return gulp.src(["src/client/**/*.*","!client/js/*.js"]).pipe(gulp.dest("bin/client/"))}),gulp.task("compile-client",["move-client"],function(){return gulp.src(["src/client/js/app.js"]).pipe(webpack(require("./webpack.config.js"))).pipe(babel({presets:[["es2015",{modules:!1}]]})).pipe(gulp.dest("bin/client/js/"))}),gulp.task("rev-rename",["compile-client"],function(){return gulp.src(["bin/client/**/*.html","bin/client/**/*.css","bin/client/**/*.js","bin/client/**/*.json","bin/client/**/*.{jpg,png,jpeg,gif,svg}"]).pipe(rev()).pipe(gulp.dest("bin/client/")).pipe(rev.manifest({path:"manifest.json"})).pipe(gulp.dest("bin/manifest/"))}),gulp.task("rev-replace",["compile-client","rev-rename"],function(){return gulp.src("bin/client/**/*.{css,js,html}").pipe(replace({manifest:gulp.src("bin/manifest/manifest.json")})).pipe(gulp.dest("bin/client/"))}),gulp.task("rev-clean",["compile-client","rev-rename"],function(){return gulp.src(["bin/client/**/*"],{read:!1}).pipe(clean("bin/manifest/manifest.json"))}),gulp.task("run",["build"],function(){nodemon({delay:1e3,script:"./server/server.js",cwd:"./bin/",args:["config.json"],ext:"html js css"}).on("restart",function(){util.log("server restarted!")})}),gulp.task("default",["run"]);